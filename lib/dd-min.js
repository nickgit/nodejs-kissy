/*
Copyright 2011, KISSY UI Library v1.30dev
MIT Licensed
build time: Dec 31 15:26
*/
KISSY.add("dd/constrain",function(m,r,s){function n(){n.superclass.constructor.apply(this,arguments)}function l(b){var d,o;b=b.drag.get("dragNode");var h=this.get("constrain");if(h){if(h===true){var a=g(window);this.__constrainRegion={left:d=a.scrollLeft(),top:o=a.scrollTop(),right:d+a.width(),bottom:o+a.height()}}if(h.nodeType||m.isString(h))h=g(h);if(h.getDOMNode){d=h.offset();this.__constrainRegion={left:d.left,top:d.top,right:d.left+h.outerWidth(),bottom:d.top+h.outerHeight()}}else if(m.isPlainObject(h))this.__constrainRegion=
h;if(this.__constrainRegion){this.__constrainRegion.right-=b.outerWidth();this.__constrainRegion.bottom-=b.outerHeight()}}}function e(b){b=b.info;var d=b.left,o=b.top,h=this.__constrainRegion;if(h){b.left=Math.min(Math.max(h.left,d),h.right);b.top=Math.min(Math.max(h.top,o),h.bottom)}}function k(){this.__constrainRegion=null}var g=s.all;m.extend(n,r,{__constrainRegion:null,attach:function(b){b.on("dragstart",l,this).on("dragend",k,this).on("dragalign",e,this)},unattach:function(b){b.detach("dragstart",
l,this).detach("dragend",k,this).detach("dragalign",e,this)}},{ATTRS:{constrain:{value:true}}});return n},{requires:["base","node"]});KISSY.add("dd",function(m,r,s,n,l,e,k,g,b){return{Draggable:s,Droppable:n,DDM:r,Constrain:e,Proxy:l,DraggableDelegate:k,DroppableDelegate:g,Scroll:b}},{requires:["dd/ddm","dd/draggable","dd/droppable","dd/proxy","dd/constrain","dd/draggable-delegate","dd/droppable-delegate","dd/scroll"]});
KISSY.add("dd/ddm",function(m,r,s,n,l,e){function k(){k.superclass.constructor.apply(this,arguments)}function g(c,i){var q=c.get("activeDrag"),A=q.get("mode"),D=c.get("validDrops"),x=0,E=0,G=a(q.get("node")),H=j(G);m.each(D,function(F){var u;if(u=F.getNodeFromTarget(i,q.get("dragNode")[0],q.get("node")[0]))if(A=="point"){if(f(a(u),q.mousePos)){u=j(a(u));if(x){if(u<E){x=F;E=u}}else{x=F;E=u}}}else if(A=="intersect"){u=j(p(G,a(u)));if(u>E){E=u;x=F}}else if(A=="strict"){u=j(p(G,a(u)));if(u==H){x=F;return false}}});
if((D=c.get("activeDrop"))&&D!=x){D._handleOut(i);q._handleOut(i)}c.set("activeDrop",x);if(x)D!=x?x._handleEnter(i):x._handleOver(i)}function b(c){var i=document;c._shim=(new l("<div style='background-color:red;position:"+(y?"absolute":"fixed")+";left:0;width:100%;height:100%;top:0;cursor:"+w.get("dragCursor")+";z-index:"+B+";'></div>")).prependTo(i.body||i.documentElement).css("opacity",0);b=d;y&&n.on(C,"resize scroll",v,c);d(c)}function d(c){var i=c.get("activeDrag").get("activeHandler"),q="auto";
if(i)q=i.css("cursor");if(q=="auto")q=c.get("dragCursor");c._shim.css({cursor:q,display:"block"});y&&v.call(c)}function o(c){var i=c.get("drops");c.set("validDrops",[]);m.each(i,function(q){q._active()})}function h(c){var i=c.get("drops");c.set("validDrops",[]);m.each(i,function(q){q._deActive()})}function a(c){var i=c.offset();return{left:i.left,right:i.left+c.outerWidth(),top:i.top,bottom:i.top+c.outerHeight()}}function f(c,i){return c.left<=i.left&&c.right>=i.left&&c.top<=i.top&&c.bottom>=i.top}
function j(c){if(c.top>=c.bottom||c.left>=c.right)return 0;return(c.right-c.left)*(c.bottom-c.top)}function p(c,i){return{left:Math.max(c.left,i.left),right:Math.min(c.right,i.right),top:Math.max(c.top,i.top),bottom:Math.min(c.bottom,i.bottom)}}var t=document,C=window,y=r.ie===6,z=m.throttle(function(c){var i=this.__activeToDrag,q=this.get("activeDrag");if(q||i)c.preventDefault();if(q){q._move(c);g(this,c)}else i&&i._move(c)},30),B=999999;k.ATTRS={prefixCls:{value:"ks-dd-"},dragCursor:{value:"move"},
clickPixelThresh:{value:3},bufferTime:{value:1E3},activeDrag:{},activeDrop:{},drops:{value:[]},validDrops:{value:[]}};var v=m.throttle(function(){var c;if((c=this.get("activeDrag"))&&c.get("shim"))this._shim.css({width:s.docWidth(),height:s.docHeight()})},30);m.extend(k,e,{__activeToDrag:0,_regDrop:function(c){this.get("drops").push(c)},_unRegDrop:function(c){c=m.indexOf(c,this.get("drops"));c!=-1&&this.get("drops").splice(c,1)},_regToDrag:function(c){n.on(t,"mouseup",this._end,this);n.on(t,"mousemove",
z,this);this.__activeToDrag=c},_start:function(){this.get("drops");var c=this.__activeToDrag;this.set("activeDrag",c);this.__activeToDrag=0;c.get("shim")&&b(this);o(this)},_addValidDrop:function(c){this.get("validDrops").push(c)},_end:function(){var c=this.get("activeDrag"),i=this.get("activeDrop");n.remove(t,"mousemove",z,this);n.remove(t,"mouseup",this._end,this);if(this.__activeToDrag){this.__activeToDrag._end();this.__activeToDrag=0}this._shim&&this._shim.hide();if(c){c._end();h(this);i&&i._end();
this.set("activeDrag",null);this.set("activeDrop",null)}}});var w=new k;w.inRegion=f;w.region=a;w.area=j;return w},{requires:["ua","dom","event","node","base"]});
KISSY.add("dd/draggable-delegate",function(m,r,s,n,l){function e(){e.superclass.constructor.apply(this,arguments)}function k(g){var b;if(this._checkMouseDown(g)){b=this.get("handlers");var d=new l(g.target);if(b=b.length?this._getHandler(d):d){this.set("activeHandler",b);b=this._getNode(b);this.set("node",b);this.set("dragNode",b);this._prepare(g)}}}m.extend(e,s,{_init:function(){this.get("container").on("mousedown",k,this).on("dragstart",this._fixDragStart)},_getHandler:function(g){for(var b=undefined,
d=this.get("container"),o=this.get("handlers");g&&g[0]!==d[0];){m.each(o,function(h){if(n.test(g[0],h)){b=g;return false}});if(b)break;g=g.parent()}return b},_getNode:function(g){return g.closest(this.get("selector"),this.get("container"))},destroy:function(){this.get("container").detach("mousedown",k,this).detach("dragstart",this._fixDragStart);this.detach()}},{ATTRS:{container:{setter:function(g){return l.one(g)}},selector:{},handlers:{value:[],getter:0}}});return e},{requires:["./ddm","./draggable",
"dom","node"]});
KISSY.add("dd/draggable",function(m,r,s,n,l){function e(){var a=this;e.superclass.constructor.apply(a,arguments);a.addTarget(l);m.each(["dragalign","drag","dragdrophit","dragend","dragdropmiss","dragexit","dragenter","dragover","dragstart"],function(f){a.publish(f,{bubbles:1})});a._init()}function k(){return false}function g(a){var f=a.target;this._checkMouseDown(a)&&this._check(f)&&this._prepare(a)}var b=m.each,d=r.ie,o=document;e.POINT="point";e.INTERSECT="intersect";e.STRICT="strict";e.ATTRS={node:{setter:function(a){return s.one(a)}},
clickPixelThresh:{valueFn:function(){return l.get("clickPixelThresh")}},bufferTime:{valueFn:function(){return l.get("bufferTime")}},dragNode:{},shim:{value:true},handlers:{value:[],getter:function(a){var f=this;a.length||(a[0]=f.get("node"));b(a,function(j,p){if(m.isFunction(j))j=j.call(f);if(m.isString(j)||j.nodeType)j=s.one(j);a[p]=j});f.__set("handlers",a);return a}},activeHandler:{},dragging:{value:false,setter:function(a){this.get("dragNode")[a?"addClass":"removeClass"](l.get("prefixCls")+"dragging")}},
mode:{value:"point"},disabled:{value:false,setter:function(a){this.get("dragNode")[a?"addClass":"removeClass"](l.get("prefixCls")+"-disabled");return a}},move:{value:false},primaryButtonOnly:{value:true},halt:{value:true},groups:{value:{}}};var h;m.extend(e,n,{startMousePos:null,startNodePos:null,_diff:null,_bufferTimer:null,_init:function(){var a=this.get("node");this.set("dragNode",a);a.on("mousedown",g,this).on("dragstart",this._fixDragStart)},_fixDragStart:function(a){a.preventDefault()},_check:function(a){var f=
this,j=f.get("handlers"),p=0;b(j,function(t){if(t.contains(a)||t[0]==a){p=1;f.set("activeHandler",t);return false}});return p},_checkMouseDown:function(a){if(this.get("primaryButtonOnly")&&a.button>1||this.get("disabled"))return 0;return 1},_prepare:function(a){var f=this;if(d){h=o.body.onselectstart;o.body.onselectstart=k}f.get("halt")?a.halt():a.preventDefault();var j=f.get("node"),p=a.pageX;a=a.pageY;j=j.offset();f.startMousePos=f.mousePos={left:p,top:a};f.startNodePos=j;f._diff={left:p-j.left,
top:a-j.top};l._regToDrag(f);if(p=f.get("bufferTime"))f._bufferTimer=setTimeout(function(){f._start()},p)},_clearBufferTimer:function(){if(this._bufferTimer){clearTimeout(this._bufferTimer);this._bufferTimer=0}},_move:function(a){var f,j=this._diff;f=this.startMousePos;var p=a.pageX;a=a.pageY;var t=p-j.left;j=a-j.top;if(this.get("dragging")){this.mousePos={left:p,top:a};f={left:t,top:j,pageX:p,pageY:a,drag:this};this.fire("dragalign",{info:f});p=1;if(this.fire("drag",f)===false)p=0;p&&this.get("move")&&
this.get("node").offset(f)}else{j=this.get("clickPixelThresh");if(Math.abs(p-f.left)>=j||Math.abs(a-f.top)>=j)this._start()}},_end:function(){var a;this._clearBufferTimer();if(d)o.body.onselectstart=h;if(this.get("dragging")){this.get("node").removeClass(l.get("prefixCls")+"drag-over");(a=l.get("activeDrop"))?this.fire("dragdrophit",{drag:this,drop:a}):this.fire("dragdropmiss",{drag:this});this.set("dragging",0);this.fire("dragend",{drag:this})}},_handleOut:function(){this.get("node").removeClass(l.get("prefixCls")+
"drag-over");this.fire("dragexit",{drag:this,drop:l.get("activeDrop")})},_handleEnter:function(a){this.get("node").addClass(l.get("prefixCls")+"drag-over");this.fire("dragenter",a)},_handleOver:function(a){this.fire("dragover",a)},_start:function(){this._clearBufferTimer();this.set("dragging",1);l._start();this.fire("dragstart",{drag:this})},destroy:function(){this.get("dragNode").detach("mousedown",g,this).detach("dragstart",this._fixDragStart);this.detach()}});return e},{requires:["ua","node","base",
"./ddm"]});
KISSY.add("dd/droppable-delegate",function(m,r,s,n,l){function e(){var g=this.get("container"),b=this.get("selector");this.__allNodes=g.all(b)}function k(){k.superclass.constructor.apply(this,arguments);r.on("dragstart",e,this)}m.extend(k,s,{getNodeFromTarget:function(g,b,d){var o={left:g.pageX,top:g.pageY};g=this.__allNodes;var h=0,a=Number.MAX_VALUE;g&&g.each(function(f){var j=f[0];if(!(j===d||j===b))if(r.inRegion(r.region(f),o)){j=r.area(r.region(f));if(j<a){a=j;h=f}}});if(h){this.set("lastNode",this.get("node"));
this.set("node",h)}return h},_handleOut:function(){k.superclass._handleOut.apply(this,arguments);this.set("node",0);this.set("lastNode",0)},_handleOver:function(g){var b=this.get("node"),d=k.superclass._handleOut,o=k.superclass._handleOver,h=k.superclass._handleEnter,a=this.get("lastNode");if(a[0]!==b[0]){this.set("node",a);d.apply(this,arguments);this.set("node",b);h.call(this,g)}else o.call(this,g)},_end:function(){k.superclass._end.apply(this,arguments);this.set("node",0)}},{ATTRS:{lastNode:{},
selector:{},container:{setter:function(g){return l.one(g)}}}});return k},{requires:["./ddm","./droppable","dom","node"]});
KISSY.add("dd/droppable",function(m,r,s,n){function l(){var e=this;l.superclass.constructor.apply(e,arguments);e.addTarget(n);m.each(["dropexit","dropenter","dropover","drophit"],function(k){e.publish(k,{bubbles:1})});e._init()}l.ATTRS={node:{setter:function(e){if(e)return r.one(e)}},groups:{value:true}};m.extend(l,s,{getNodeFromTarget:function(e,k,g){e=this.get("node");var b=e[0];return b==k||b==g?null:e},_init:function(){n._regDrop(this)},_active:function(){var e=n.get("activeDrag"),k=this.get("node"),
g=this.get("groups"),b=e.get("groups");e=n.get("prefixCls");a:if(g===true)g=1;else{for(var d in g)if(b[d]){g=1;break a}g=0}if(g){n._addValidDrop(this);k&&k.addClass(e+"drop-active-valid")}else k&&k.addClass(e+"drop-active-invalid")},_deActive:function(){var e=this.get("node"),k=n.get("prefixCls");e&&e.removeClass(k+"drop-active-valid").removeClass(k+"drop-active-invalid")},__getCustomEvt:function(e){return m.mix({drag:n.get("activeDrag"),drop:this},e)},_handleOut:function(){var e=this.__getCustomEvt();
this.get("node").removeClass(n.get("prefixCls")+"drop-over");this.fire("dropexit",e)},_handleEnter:function(e){e=this.__getCustomEvt(e);e.drag._handleEnter(e);this.get("node").addClass(n.get("prefixCls")+"drop-over");this.fire("dropenter",e)},_handleOver:function(e){e=this.__getCustomEvt(e);e.drag._handleOver(e);this.fire("dropover",e)},_end:function(){var e=this.__getCustomEvt();this.get("node").removeClass(n.get("prefixCls")+"drop-over");this.fire("drophit",e)},destroy:function(){n._unRegDrop(this)}});
return l},{requires:["node","base","./ddm"]});
KISSY.add("dd/proxy",function(m,r,s){function n(){n.superclass.constructor.apply(this,arguments);this[l]={}}var l="__proxy_destructors",e=m.stamp,k=m.guid("__dd_proxy"),g="__proxy";n.ATTRS={node:{value:function(b){return new r(b.get("node").clone(true))}},destroyOnEnd:{value:false},moveOnEnd:{value:true}};m.extend(n,s,{attach:function(b){function d(){var f=h.get("node"),j=b.get("node");if(h[g])f=h[g];else if(m.isFunction(f)){f=f(b);f.addClass("ks-dd-proxy");f.css("position","absolute");h[g]=f}j.parent().append(f);
f.show();f.offset(j.offset());b.set("dragNode",j);b.set("node",f)}function o(){var f=h[g];h.get("moveOnEnd")&&b.get("dragNode").offset(f.offset());if(h.get("destroyOnEnd")){f.remove();h[g]=0}else f.hide();b.set("node",b.get("dragNode"))}var h=this,a=e(b,1,k);if(!(a&&h[l][a])){b.on("dragstart",d);b.on("dragend",o);a=e(b,0,k);h[l][a]={drag:b,fn:function(){b.detach("dragstart",d);b.detach("dragend",o)}}}},unAttach:function(b){b=e(b,1,k);var d=this[l];if(b&&d[b]){d[b].fn();delete d[b]}},destroy:function(){var b=
this.get("node"),d=this[l];b&&!m.isFunction(b)&&b.remove();for(var o in d)this.unAttach(d[o].drag)}});return n},{requires:["node","base"]});
KISSY.add("dd/scroll",function(m,r,s,n){function l(){l.superclass.constructor.apply(this,arguments);this[g]={}}var e=m.stamp,k=100,g="__dd_scrolls";l.ATTRS={node:{valueFn:function(){return s.one(window)},setter:function(d){return s.one(d)}},rate:{value:[10,10]},diff:{value:[20,20]}};var b=m.isWindow;m.extend(l,r,{getRegion:function(d){return b(d[0])?{width:n.viewportWidth(),height:n.viewportHeight()}:{width:d.outerWidth(),height:d.outerHeight()}},getOffset:function(d){return b(d[0])?{left:n.scrollLeft(),
top:n.scrollTop()}:d.offset()},getScroll:function(d){return{left:d.scrollLeft(),top:d.scrollTop()}},setScroll:function(d,o){d.scrollLeft(o.left);d.scrollTop(o.top)},unAttach:function(d){var o,h=this[g];if((o=e(d,1,"__dd-scroll-id-"))&&h[o]){h[o].fn();delete h[o]}},destroy:function(){var d=this[g],o;for(o in d)this.unAttach(d[o].drag)},attach:function(d){function o(v){if(!v.fake){var w=f.get("node");y=v;z=m.clone(d.mousePos);v=f.getOffset(w);z.left-=v.left;z.top-=v.top;B||a()}}function h(){clearTimeout(B);
B=null}function a(){var v=f.get("node"),w=f.getRegion(v),c=w.width;w=w.height;var i=f.getScroll(v),q=m.clone(i),A=false;if(z.top-w>=-C[1]){i.top+=t[1];A=true}if(z.top<=C[1]){i.top-=t[1];A=true}if(z.left-c>=-C[0]){i.left+=t[0];A=true}if(z.left<=C[0]){i.left-=t[0];A=true}if(A){f.setScroll(v,i);B=setTimeout(a,k);y.fake=true;if(b(v[0])){i=f.getScroll(v);y.left+=i.left-q.left;y.top+=i.top-q.top}d.get("move")&&d.get("node").offset(y);d.fire("drag",y)}else B=null}var f=this,j=e(d,0,"__dd-scroll-id-"),p=
f[g];if(!p[j]){var t=f.get("rate"),C=f.get("diff"),y,z,B=null;d.on("drag",o);d.on("dragend",h);p[j]={drag:d,fn:function(){d.detach("drag",o);d.detach("dragend",h)}}}}});return l},{requires:["base","node","dom"]});
